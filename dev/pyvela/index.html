<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting started: The pyvela interface · Vela.jl</title><meta name="title" content="Getting started: The pyvela interface · Vela.jl"/><meta property="og:title" content="Getting started: The pyvela interface · Vela.jl"/><meta property="twitter:title" content="Getting started: The pyvela interface · Vela.jl"/><meta name="description" content="Documentation for Vela.jl."/><meta property="og:description" content="Documentation for Vela.jl."/><meta property="twitter:description" content="Documentation for Vela.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Vela.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li class="is-active"><a class="tocitem" href>Getting started: The <code>pyvela</code> interface</a><ul class="internal"><li><a class="tocitem" href="#Reading-par-and-tim-files-using-the-SPNTA-class"><span>Reading <code>par</code> and <code>tim</code> files using the <code>SPNTA</code> class</span></a></li><li><a class="tocitem" href="#Setting-up-the-sampler"><span>Setting up the sampler</span></a></li><li><a class="tocitem" href="#Running-MCMC-and-getting-the-samples"><span>Running MCMC and getting the samples</span></a></li><li><a class="tocitem" href="#Printing-out-the-results"><span>Printing out the results</span></a></li><li><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li></ul></li><li><a class="tocitem" href="../pyvela-cli/">Command line utilities</a></li><li><span class="tocitem">Explanation &amp; API Reference</span><ul><li><a class="tocitem" href="../precision/">Precision</a></li><li><a class="tocitem" href="../quantities/">Quantities</a></li><li><a class="tocitem" href="../toas/">Pulse Times of Arrival (TOAs)</a></li><li><a class="tocitem" href="../timing-model/">The Timing &amp; Noise Model</a></li><li><a class="tocitem" href="../residuals/">Residuals</a></li><li><a class="tocitem" href="../likelihood/">The Likelihood Function and Kernels</a></li><li><a class="tocitem" href="../red-noise/">Red noise models</a></li><li><a class="tocitem" href="../parameters/">Parameters</a></li><li><a class="tocitem" href="../priors/">Prior and Posterior distributions</a></li></ul></li><li><a class="tocitem" href="../issues/">Known issues</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting started: The <code>pyvela</code> interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting started: The <code>pyvela</code> interface</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/abhisrkckl/Vela.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/abhisrkckl/Vela.jl/blob/main/docs/src/pyvela.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-started:-The-pyvela-interface"><a class="docs-heading-anchor" href="#Getting-started:-The-pyvela-interface">Getting started: The <code>pyvela</code> interface</a><a id="Getting-started:-The-pyvela-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started:-The-pyvela-interface" title="Permalink"></a></h1><p><code>Vela.jl</code> must interact with Python for three reasons: (1) most pulsar astronomers are more  familiar with Python than Julia (2) Python has many samplers that have no counterpart in  Julia, and most importantly, (3) it is a real pain to implement <code>par</code> and <code>tim</code> file readers. The <code>pyvela</code> interface allows one to access <code>Vela.jl</code> from Python. This is the simplest way to get started with <code>Vela.jl</code>.</p><p>The <code>pyvela</code> interface is demonstrated below using an example with the <code>emcee</code> sampler.</p><h2 id="Reading-par-and-tim-files-using-the-SPNTA-class"><a class="docs-heading-anchor" href="#Reading-par-and-tim-files-using-the-SPNTA-class">Reading <code>par</code> and <code>tim</code> files using the <code>SPNTA</code> class</a><a id="Reading-par-and-tim-files-using-the-SPNTA-class-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-par-and-tim-files-using-the-SPNTA-class" title="Permalink"></a></h2><p>A pulsar timing dataset usually contains a <code>par</code> file and a <code>tim</code> file. The <code>tim</code> file contains the pulse time of arrival (TOA) measurements and related metadata, and the <code>par</code> file contains a timing &amp; noise model that fits the TOAs along with its parameter values. <code>pyvela</code> reads these files with the  help of the <a href="https://nanograv-pint.readthedocs.io/"><code>PINT</code></a> package. <code>PINT</code> also does the clock  corrections and solar system ephemeris calculations. See <a href="https://nanograv-pint.readthedocs.io/en/latest/explanation.html">this page</a> for detailed explanations on these topics.</p><p>Here is how we read read a pair of <code>par</code> and <code>tim</code> files in <code>pyvela</code>:</p><pre><code class="nohighlight hljs">from pyvela import SPNTA, Vela, pyvela_plot
import numpy as np

parfile, timfile = &quot;NGC6440E.par&quot;, &quot;NGC6440E.tim&quot;
spnta = SPNTA(
    parfile, 
    timfile,
    cheat_prior_scale=100,
    custom_priors={},
    analytic_marginalized_params=[&quot;PHOFF&quot;, &quot;F&quot;],
)</code></pre><p>Here, the <code>cheat_prior_scale</code> and <code>custom_priors</code> arguments are used for specifying the prior distributions for model parameters. See <a href="../priors/#Representing-priors-in-a-JSON-file">Representing priors in a <code>JSON</code> file</a> for more details. <code>analytic_marginalized_params</code> represents parameters that are analytically marginalized assuming infinitely  wide improper priors. Only parameters whose effect on the timing residuals is approximately linear are allowed to be analytically marginalized. This is different from <code>ENTERPRISE</code>, where the timing model is linearized in  all timing parameters.</p><p>An <code>SPNTA</code> object stores a pulsar timing &amp; noise model along with the measured TOAs. Here, <code>spnta.model</code> is a <code>Vela.TimingModel</code> object and <code>spnta.toas</code> is a <code>Vector{Vela.TOA}</code> object.  The <code>SPNTA</code> class reads the <code>par</code> and <code>tim</code> files using the <a href="https://nanograv-pint.readthedocs.io/en/latest/_autosummary/pint.models.model_builder.get_model_and_toas.html"><code>pint.models.get_model_and_toas()</code></a> function under the hood and converts the resulting <code>pint.models.TimingModel</code> and <code>pint.toa.TOAs</code> objects into the corresponding <code>Vela.jl</code> objects. Note that this conversion does not preserve all the information present in the <code>PINT</code> objects, and is not reversible.</p><p>The <code>SPNTA</code> class internally uses the <code>Vela.Pulsar</code> type to store the timing model and the TOAs together. Currently it is assumed that all the TOAs are of the same paradigm (narrowband or wideband). Inhomogeneous datasets are not yet supported.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vela.Pulsar" href="#Vela.Pulsar"><code>Vela.Pulsar</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Pulsar{M&lt;:TimingModel,T&lt;:TOABase}</code></pre><p>Represents a pulsar dataset with a timing model and a set of TOAs. All TOAs must be of the same paradigm (narrowband/wideband).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/abhisrkckl/Vela.jl/blob/24e646aca2a4fae084e17e171ff26835725a347c/src/pulsar/pulsar.jl#L3-L8">source</a></section></article><p>Everything defined in <code>Vela.jl</code> will be available through the <code>Vela</code> namespace above, e.g., <code>Vela.TimingModel</code>  and <code>Vela.TOA</code>. Things that were explicitly imported into <code>Vela.jl</code> are also available, e.g., <code>Vela.GQ</code> is the <code>GQ</code> type  from <code>GeometricUnits.jl</code> (see <a href="../quantities/#Quantities">Quantities</a>). Other things from Julia are accessed using the  <a href="https://juliapy.github.io/PythonCall.jl/stable/juliacall/"><code>juliacall</code></a> package.</p><p>The <code>SPNTA</code> object created above provides functions like <code>lnlike()</code>, <code>lnprior()</code>, <code>prior_transform()</code>, <code>lnpost()</code>, and  <code>lnpost_vectorized()</code>. These provide the log-likelihood, log-prior, prior transform, and log-posterior  functions which call <code>Vela.jl</code> under the hood. The difference between <code>spnta.lnpost</code> and  <code>spnta.lnpost_vectorized</code> is that if multiple threads are allowed (by setting the <code>PYTHON_JULIACALL_THREADS</code> environment variable), <code>spnta.lnpost</code> parallelizes a single log-posterior computation across TOAs, whereas <code>spnta.lnpost_vectorized</code> computes the log-posterior at multiple points in the parameter space parallelly. The latter can be used with samplers such as <code>emcee</code> and <code>zeus</code>. Make sure not to set <code>PYTHON_JULIACALL_THREADS</code>  to a value greater than the number of available CPU cores.</p><p>The <code>SPNTA</code> object also provides several useful attributes. These are:</p><ol><li><code>ndim</code> - Number of free parameters.</li><li><code>ntmdim</code> - Number of timing model parameters (excludes noise parameters and hyperparameters).</li><li><code>param_names</code> - Free paramater names in <code>PINT</code> convention.</li><li><code>param_units</code> - Free paramater unit strings in <code>astropy.units</code> convention as used in <code>PINT</code>.</li><li><code>param_labels</code> - Free parameter labels containing names and units.</li><li><code>param_prefixes</code> - Free parameter prefixes in <code>PINT</code> convention.</li><li><code>marginalized_param_names</code> - Names of the analytically marginalized parameters. This may include correlated noise amplitudes as well as linear timing model paramaters as defined by the <code>analytic_marginalized_params</code> option. This follows <code>PINT</code> conventions as much as possible.</li><li><code>scale_factors</code> - Scale factors used to convert parameters from normal pulsar timing units to <code>Vela.jl</code>&#39;s internal units.</li><li><code>default_params</code> - Default free parameter values taken from the <code>par</code> file (in <code>Vela.jl</code>&#39;s internal units).</li><li><code>maxpost_params</code> - Maximum-posterior parameters estimated using the Nelder-Mead method (in <code>Vela.jl</code>&#39;s internal units).</li><li><code>has_marginalized_gp_noise</code> - Whether the timing &amp; noise model contains marginalized Gaussian process components (Boolean).</li><li><code>has_ecorr_noise</code> - Whether the timing &amp; noise model contains ECORR noise (Boolean).</li><li><code>wideband</code> - Whether the TOAs are wideband (Boolean).</li><li><code>mjds</code> - Observing epochs in MJD.</li></ol><p>The methods available in <code>SPNTA</code> other than the ones mentioned above are:</p><ol><li><code>rescale_samples(samples_raw)</code> - Rescales samples from <code>Vela.jl</code> internal units to the usual units used in pulsar astronomy (see <a href="https://nanograv-pint.readthedocs.io/en/latest/timingmodels.html#supported-parameters">this page</a>).</li><li><code>get_marginalized_gp_noise_realization(params)</code> - Given free parameter values, compute the Gaussian process realization of the analytically marginalized parameters.</li><li><code>time_residuals(params)</code> - Compute the time residuals given a set of paramater values.</li><li><code>whitened_time_residuals(params)</code> - Compute the whitened time residuals given a set of paramater values.</li><li><code>dm_residuals(params)</code> - Compute the DM residuals given a set of paramater values (wideband only).</li><li><code>whitened_dm_residuals(params)</code> - Compute the whitened DM residuals given a set of paramater values (wideband only).</li><li><code>scaled_toa_unceritainties(params)</code> - Compute the scaled TOA uncertainties given a set of paramater values.</li><li><code>scaled_dm_unceritainties(params)</code> - Compute the scaled DM uncertainties given a set of paramater values (wideband only).</li><li><code>model_dm(params)</code> - Compute the DM predicted by the model given a set of paramater values.</li></ol><h2 id="Setting-up-the-sampler"><a class="docs-heading-anchor" href="#Setting-up-the-sampler">Setting up the sampler</a><a id="Setting-up-the-sampler-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-the-sampler" title="Permalink"></a></h2><p>We show below an example using the <a href="https://emcee.readthedocs.io/"><code>emcee</code></a> sampler.</p><pre><code class="nohighlight hljs">import emcee

nwalkers = spnta.ndim * 5
p0 = np.array([spnta.prior_transform(cube) for cube in np.random.rand(nwalkers, spnta.ndim)])

sampler = emcee.EnsembleSampler(
    nwalkers,
    spnta.ndim,
    spnta.lnpost_vectorized,
    moves=[emcee.moves.StretchMove(), emcee.moves.DESnookerMove()],
    vectorize=True,
)</code></pre><p><code>p0</code> contains random draws from the prior distribution (see <a href="https://en.wikipedia.org/wiki/Inverse_transform_sampling">this page</a> for an explanation on how this works). Note the <code>vectorize=True</code> while creating the sampler. This must be given if we are using the  vectorized log-posterior. In practice, the <code>moves</code> should be optimized based on the problem at hand.</p><h2 id="Running-MCMC-and-getting-the-samples"><a class="docs-heading-anchor" href="#Running-MCMC-and-getting-the-samples">Running MCMC and getting the samples</a><a id="Running-MCMC-and-getting-the-samples-1"></a><a class="docs-heading-anchor-permalink" href="#Running-MCMC-and-getting-the-samples" title="Permalink"></a></h2><pre><code class="nohighlight hljs">sampler.run_mcmc(p0, 6000, progress=True)</code></pre><p>This will only take a few seconds because the dataset is very small. Larger datasets may take minutes or hours depending on the size and the computing power available.</p><pre><code class="nohighlight hljs">samples_raw = sampler.get_chain(flat=True, discard=1000, thin=50)</code></pre><p>This flattens the multiple chains <code>emcee</code> was running. Also note the burn-in (<code>discard</code>)  and the thinning. These samples are in <code>Vela.jl</code>&#39;s internal units (see <a href="../quantities/#Quantities">Quantities</a>).</p><pre><code class="nohighlight hljs">samples = spnta.rescale_samples(samples_raw)</code></pre><p>This converts the samples into the usual units used in pulsar astronomy.</p><h2 id="Printing-out-the-results"><a class="docs-heading-anchor" href="#Printing-out-the-results">Printing out the results</a><a id="Printing-out-the-results-1"></a><a class="docs-heading-anchor-permalink" href="#Printing-out-the-results" title="Permalink"></a></h2><pre><code class="nohighlight hljs">means = np.mean(samples_v, axis=0)
stds = np.std(samples_v, axis=0)
for idx, (pname, mean, std) in enumerate(zip(spnta.param_names, means, stds)):
    if pname == &quot;F0&quot;:
        F0_ = np.longdouble(spnta.model.param_handler._default_params_tuple.F_.x)
        print(f&quot;{pname}\t\t{mean + F0_}\t\t{std}&quot;)    
    else:
        print(f&quot;{pname}\t\t{mean}\t\t{std}&quot;)</code></pre><p>The special treatment for F0 is explained in <a href="../precision/#Precision">Precision</a>.</p><h2 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h2><pre><code class="nohighlight hljs">import corner
import matplotlib.pyplot as plt

fig = corner.corner(
    samples_v,
    labels=spnta.param_labels,
    label_kwargs={&quot;fontsize&quot;: 11},
    range=[0.999] * spnta.ndim,
    plot_datapoints=False,
    hist_kwargs={&quot;density&quot;: True},
    labelpad=0.3,
)
plt.suptitle(spnta.model.pulsar_name)
plt.tight_layout()
plt.show()</code></pre><p>The output looks something like this: <img src="../NGC6440E_posterior.png" alt="NGC6440E_posterior"/></p><p>Note that the F0 plot is centered around 0. Refer to <a href="../precision/#Precision">Precision</a> for why this is.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../installation/">« Installation</a><a class="docs-footer-nextpage" href="../pyvela-cli/">Command line utilities »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Tuesday 10 June 2025 09:58">Tuesday 10 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
